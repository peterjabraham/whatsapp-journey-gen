<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Builder - WhatsApp Journey Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <a href="/" class="nav-link">‚Üê Back to Journey Generator</a>
            <h1>Prompt Builder</h1>
            <p class="subtitle">Fill in the details below to generate your prompt.md file</p>
            <p class="subtitle" style="margin-top: 10px; font-size: 0.95em;">Once you have your prompt .md file, move on to the Journey Generator.</p>
        </header>

        <main>
            <div class="info-banner">
                <strong>üìù Step 1: Build Your Prompt</strong>
                <p>
                    Fill out all the fields below to create your custom prompt.md file. 
                    This file will contain all the details about your brand, timeline, and journey requirements. 
                    Once generated, you can download the prompt.md file and use it in the 
                    <a href="/">Journey Generator</a> to create your WhatsApp journeys.
                </p>
            </div>

            <form id="promptBuilderForm">
                <!-- 0.1 CONTEXT -->
                <div class="form-section">
                    <h2>0.1 CONTEXT</h2>
                    
                    <div class="form-group">
                        <label for="platform">Platform</label>
                        <input type="text" id="platform" name="platform" value="WATI (WhatsApp marketing automation)" required>
                        <div class="help-text">Example: WATI (WhatsApp marketing automation)</div>
                    </div>

                    <div class="form-group">
                        <label for="format">Format</label>
                        <input type="text" id="format" name="format" value="B2C consumer acquisition journeys" required>
                        <div class="help-text">Example: B2C consumer acquisition journeys</div>
                    </div>

                    <div class="form-group">
                        <label for="duration_overall">Duration (overall journey)</label>
                        <input type="text" id="duration_overall" name="duration_overall" value="3 days + initial Day 0 (0-3 hours)" required>
                        <div class="help-text">Example: 3 days + initial Day 0 (0-3 hours)</div>
                    </div>

                    <div class="form-group">
                        <label for="discount">Discount (describe clearly)</label>
                        <input type="text" id="discount" name="discount" placeholder="15% OFF your first order / Free shipping / Tiered discount">
                        <div class="help-text">Example: 15% OFF your first order / Free shipping / Tiered discount</div>
                    </div>

                    <div class="form-group">
                        <label for="brand_name">Brand Name</label>
                        <input type="text" id="brand_name" name="brand_name" required>
                        <div class="help-text">Example: Nike</div>
                    </div>

                    <div class="form-group">
                        <label for="industry">Industry</label>
                        <input type="text" id="industry" name="industry" required>
                        <div class="help-text">Example: Sportswear / Financial Services / Beauty</div>
                    </div>

                    <div class="form-group">
                        <label>Unique Selling Points (3-5 bullets)</label>
                        <div id="uniqueSellingPointsList" class="dynamic-list"></div>
                        <button type="button" class="btn-add" onclick="addListItem('uniqueSellingPointsList', 'unique_selling_points')">+ Add Point</button>
                        <div class="help-text">What makes you different</div>
                    </div>

                    <div class="form-group">
                        <label for="brand_tone">Brand Tone of Voice</label>
                        <textarea id="brand_tone" name="brand_tone" placeholder="Warm, direct, plain English, minimal emojis"></textarea>
                        <div class="help-text">Example: "Warm, direct, plain English, minimal emojis", or URL to guidelines</div>
                    </div>

                    <div class="form-group">
                        <label for="brand_colours">Brand Colours</label>
                        <textarea id="brand_colours" name="brand_colours" placeholder="Use brand colours from this URL: [URL] or list HEX codes like #667eea, #764ba2"></textarea>
                        <div class="help-text">Example: "Use brand colours from this URL: [URL]" or list HEX codes</div>
                    </div>

                    <div class="form-group">
                        <label for="url_homepage">Homepage URL</label>
                        <input type="url" id="url_homepage" name="url_homepage" placeholder="https://example.com">
                    </div>

                    <div class="form-group">
                        <label>Product Page URLs</label>
                        <div id="productPagesList" class="dynamic-list"></div>
                        <button type="button" class="btn-add" onclick="addListItem('productPagesList', 'url_product_pages')">+ Add URL</button>
                    </div>

                    <div class="form-group">
                        <label>Offer Page URLs</label>
                        <div id="offerPagesList" class="dynamic-list"></div>
                        <button type="button" class="btn-add" onclick="addListItem('offerPagesList', 'url_offer_pages')">+ Add URL</button>
                    </div>

                    <div class="form-group">
                        <label>Products</label>
                        <div id="productsList" class="dynamic-list"></div>
                        <button type="button" class="btn-add" onclick="addListItem('productsList', 'products')">+ Add Product</button>
                        <div class="help-text">List your key products or product categories, or URLs</div>
                    </div>

                    <div class="form-group">
                        <label for="offer_text">The Offer (exact wording)</label>
                        <textarea id="offer_text" name="offer_text" required></textarea>
                        <div class="help-text">Example: Special Offer: Receive a ¬£50 Amazon.co.uk Gift Card when you open a new Lifetime ISA by 19th December 2025.</div>
                    </div>

                    <div class="form-group">
                        <label for="quote_code">Quote Code</label>
                        <input type="text" id="quote_code" name="quote_code" required>
                        <div class="help-text">Example: Autumn25</div>
                    </div>

                    <div class="form-group">
                        <label>Example Testimonials (URLs)</label>
                        <div id="testimonialsList" class="dynamic-list"></div>
                        <button type="button" class="btn-add" onclick="addListItem('testimonialsList', 'url_testimonials')">+ Add URL</button>
                        <div class="help-text">URLs to testimonials/case study pages</div>
                    </div>

                    <div class="form-group">
                        <label for="audience">Audience</label>
                        <input type="text" id="audience" name="audience" required>
                        <div class="help-text">Example: "UK police officers aged 25-45" / "Busy parents in London"</div>
                    </div>

                    <div class="form-group">
                        <label for="compliance">Compliance / Restrictions</label>
                        <textarea id="compliance" name="compliance" placeholder="FCA-regulated; avoid guarantees"></textarea>
                        <div class="help-text">Example: "FCA-regulated; avoid guarantees", "No medical claims", etc.</div>
                    </div>
                </div>

                <!-- 0.2 DELIVERABLES -->
                <div class="form-section">
                    <h2>0.2 DELIVERABLES NEEDED</h2>
                    
                    <div class="form-group">
                        <label for="num_journeys">Number of journeys required (1-4 recommended)</label>
                        <select id="num_journeys" name="num_journeys" required>
                            <option value="1">1 Journey</option>
                            <option value="2">2 Journeys</option>
                            <option value="3" selected>3 Journeys</option>
                            <option value="4">4 Journeys</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Which deliverables do you want?</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="deliverable_1" name="deliverables[]" value="1" checked>
                                <label for="deliverable_1">1. Journey Markdown Documents</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="deliverable_2a" name="deliverables[]" value="2A" checked>
                                <label for="deliverable_2a">2A. Summary Workflow HTML</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="deliverable_2b" name="deliverables[]" value="2B" checked>
                                <label for="deliverable_2b">2B. Full Detail Workflow HTML</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 0.3 TIMELINE -->
                <div class="form-section">
                    <h2>0.3 JOURNEY TIMELINE PREFERENCES</h2>
                    
                    <div class="form-group">
                        <label for="day0_duration">Day 0 duration</label>
                        <input type="text" id="day0_duration" name="day0_duration" value="0-3 hours" required>
                        <div class="help-text">Example: 0-3 hours, 0-2 hours, 0-4 hours</div>
                    </div>

                    <div class="form-group">
                        <label for="day0_step1_timing">Day 0 ‚Äì Step 1 timing (Welcome)</label>
                        <input type="text" id="day0_step1_timing" name="day0_step1_timing" value="Immediate" required>
                        <div class="help-text">Example: Immediate</div>
                    </div>

                    <div class="form-group">
                        <label for="day0_step2_timing">Day 0 ‚Äì Step 2 timing (Benefits/info)</label>
                        <input type="text" id="day0_step2_timing" name="day0_step2_timing" value="+30 minutes" required>
                        <div class="help-text">Example: +30 minutes, +1 hour</div>
                    </div>

                    <div class="form-group">
                        <label for="day0_step3_timing">Day 0 ‚Äì Step 3 timing (Decision buttons)</label>
                        <input type="text" id="day0_step3_timing" name="day0_step3_timing" value="+2 hours" required>
                        <div class="help-text">Example: +2 hours, +90 minutes</div>
                    </div>

                    <div class="form-group">
                        <label for="day1_start">Day 1 start (from last Day 0 message)</label>
                        <input type="text" id="day1_start" name="day1_start" value="+24 hours" required>
                        <div class="help-text">Example: +24 hours, +12 hours, +48 hours</div>
                    </div>

                    <div class="form-group">
                        <label for="day2_start">Day 2 start (from last Day 1 message)</label>
                        <input type="text" id="day2_start" name="day2_start" value="+24 hours" required>
                        <div class="help-text">Example: +24 hours, +12 hours</div>
                    </div>

                    <div class="form-group">
                        <label for="day3_start">Day 3 start (from last Day 2 message)</label>
                        <input type="text" id="day3_start" name="day3_start" value="+24 hours" required>
                        <div class="help-text">Example: +24 hours, +12 hours</div>
                    </div>

                    <div class="form-group">
                        <label for="final_push_timing">Final push timing (after discount reveal)</label>
                        <input type="text" id="final_push_timing" name="final_push_timing" value="+3 hours" required>
                        <div class="help-text">Example: +3 hours, +2 hours</div>
                    </div>
                </div>

                <!-- 0.4 JOURNEY STRUCTURE -->
                <div class="form-section">
                    <h2>0.4 JOURNEY STRUCTURE (GLOBAL RULES)</h2>
                    
                    <div class="form-group">
                        <label for="urgency_level">Urgency level</label>
                        <select id="urgency_level" name="urgency_level" required>
                            <option value="subtle">Subtle</option>
                            <option value="medium" selected>Medium</option>
                            <option value="strong">Strong</option>
                        </select>
                        <div class="help-text">Example: subtle / medium / strong</div>
                    </div>

                    <div class="form-group">
                        <label for="journey_exceptions">Journey exceptions (optional)</label>
                        <textarea id="journey_exceptions" name="journey_exceptions" placeholder="If you want exceptions (e.g. different durations per journey), specify here"></textarea>
                    </div>
                </div>

                <!-- 0.7 BRAND VOICE -->
                <div class="form-section">
                    <h2>0.7 BRAND VOICE SETTINGS</h2>
                    
                    <div class="form-group">
                        <label for="sophistication_level">Sophistication level (1-10)</label>
                        <input type="number" id="sophistication_level" name="sophistication_level" min="1" max="10" value="7" required>
                        <div class="help-text">Example: 3 = very casual, 10 = very formal</div>
                    </div>

                    <div class="form-group">
                        <label for="tone">Tone</label>
                        <input type="text" id="tone" name="tone" value="professional" required>
                        <div class="help-text">Example: warm / professional / clinical / friendly / playful / etc.</div>
                    </div>

                    <div class="form-group">
                        <label for="emoji_usage">Emoji usage</label>
                        <select id="emoji_usage" name="emoji_usage" required>
                            <option value="minimal" selected>Minimal</option>
                            <option value="strategic">Strategic</option>
                            <option value="frequent">Frequent</option>
                        </select>
                        <div class="help-text">Example: minimal / strategic / frequent</div>
                    </div>

                    <div class="form-group">
                        <label>Key brand attributes (keywords)</label>
                        <div id="brandAttributesList" class="dynamic-list"></div>
                        <button type="button" class="btn-add" onclick="addListItem('brandAttributesList', 'brand_attributes')">+ Add Attribute</button>
                        <div class="help-text">Example: trustworthy, expert, supportive, no-nonsense</div>
                    </div>

                    <div class="form-group">
                        <label for="language_to_avoid">Language to avoid</label>
                        <textarea id="language_to_avoid" name="language_to_avoid" placeholder="no slang, avoid hypey claims, no guarantees"></textarea>
                        <div class="help-text">Example: "no slang", "avoid hypey claims", "no guarantees"</div>
                    </div>
                </div>

                <button type="submit" class="btn-primary">
                    <span class="btn-text">Generate Prompt File</span>
                </button>

                <div id="errorMessage" class="error-message" style="display: none;"></div>
                <div id="successMessage" class="success-message" style="display: none;"></div>
            </form>

            <div id="nextStepButton" style="display: none; margin-top: 30px; text-align: center;">
                <a href="/" class="btn-primary" style="display: inline-block; text-decoration: none; max-width: 400px;">
                    <span class="btn-text">On to Journey Generator ‚Üí</span>
                </a>
            </div>
        </main>
    </div>

    <script>
        let listCounters = {
            uniqueSellingPointsList: 0,
            productPagesList: 0,
            offerPagesList: 0,
            productsList: 0,
            testimonialsList: 0,
            brandAttributesList: 0
        };

        function addListItem(containerId, fieldName) {
            const container = document.getElementById(containerId);
            const counter = listCounters[containerId] || 0;
            const newId = `${fieldName}_${counter}`;
            
            const item = document.createElement('div');
            item.className = 'list-item';
            item.id = `item_${newId}`;
            item.innerHTML = `
                <input type="text" name="${fieldName}[]" placeholder="Enter ${fieldName.replace(/_/g, ' ')}" required>
                <button type="button" class="btn-remove" onclick="removeListItem('item_${newId}')">Remove</button>
            `;
            
            container.appendChild(item);
            listCounters[containerId] = counter + 1;
        }

        function removeListItem(itemId) {
            const item = document.getElementById(itemId);
            if (item) {
                item.remove();
            }
        }

        // Build deliverables string
        function buildDeliverablesString() {
            const checkboxes = document.querySelectorAll('input[name="deliverables[]"]:checked');
            const values = Array.from(checkboxes).map(cb => cb.value);
            const numJourneys = document.getElementById('num_journeys').value;
            return `Journeys: ${numJourneys}. Deliverables: ${values.join(', ')}`;
        }

        // Form submission
        document.getElementById('promptBuilderForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const form = e.target;
            const formData = new FormData(form);
            
            // Build deliverables string
            const deliverables = buildDeliverablesString();
            formData.set('deliverables', deliverables);
            
            // Remove individual deliverable checkboxes from form data
            formData.delete('deliverables[]');
            
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const nextStepButton = document.getElementById('nextStepButton');
            
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            nextStepButton.style.display = 'none';
            
            try {
                const response = await fetch('/api/generate-prompt', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    // Download the file
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'PROMPT_4_WhatsApp_Journey_Generator.md';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    successMessage.textContent = 'Prompt file generated successfully! Download started.';
                    successMessage.style.display = 'block';
                    
                    // Show the "On to Journey Generator" button
                    document.getElementById('nextStepButton').style.display = 'block';
                } else {
                    const error = await response.json();
                    errorMessage.textContent = error.error || 'An error occurred';
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                errorMessage.textContent = `Error: ${error.message}`;
                errorMessage.style.display = 'block';
            }
        });
    </script>
</body>
</html>

